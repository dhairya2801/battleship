/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ (() => {

eval("{// TODO:\n// 2. check overflow when rotated\n// 3. mark ship and adjacent cells when hit/destroyed\n// 4. remove the coords from the db when a placed ship is held for dragging\n// 5. make computer smarter and solve game not stopping when computer wins.\n// 6. resolve all cells being red when scrolling on 2+ cells glitch\n// 7. keep user board disabled from game start to end\n\nconst boards = document.getElementById('boards');\nconst board1 = document.getElementById('board1');\nconst board2 = document.getElementById('board2');\nconst frame2 = document.getElementById('frame2');\nconst shipDock = document.getElementById('ship-dock');\n\ncreateBoard(board1);\ncreateBoard(board2);\n\nfunction createBoard(board) {\n    for (let i=0; i<100; i++) {\n        const cell = document.createElement('div');\n        cell.classList.add('board-cell');\n        cell.dataset.row = Math.floor(i / 10);\n        cell.dataset.col = i % 10;\n        board.appendChild(cell);\n    }\n}\n\nconst ships = document.querySelectorAll('.ship');\nships.forEach(ship => {\n    ship.addEventListener('dragstart', (e) => {\n        e.dataTransfer.setData('text/plain', e.target.id);\n    })\n});\n\nboard1.addEventListener('dragover', handleDragOver);\nfunction handleDragOver(e) {\n    e.preventDefault();\n}\n\nboard1.addEventListener('drop', handleDrop);\nfunction handleDrop(e) {\n    e.preventDefault();\n    // getBoundingClientRect gives the position of board1 relative to the viewport\n    const x = e.clientX - board1.getBoundingClientRect().left;\n    const y = e.clientY - board1.getBoundingClientRect().top;\n    \n    // to convert mouse's window coordinates (clientX, Y) into the board1's grid\n    // coordinates.\n    const col = Math.floor(x/40);\n    const row = Math.floor(y/40);\n    const snapLeft = col * 40;\n    const snapTop = row * 40;\n        \n    const id = e.dataTransfer.getData('text/plain');\n    const draggableElement = document.getElementById(id);\n    const isRotated = draggableElement.classList.contains('rotated');\n\n    let length = getShipLength(id);\n\n    if (isOverflowing(col, row, length, isRotated)) {\n        return;\n    }\n    \n    if (isOverlapping(col, row, length, isRotated, playerShipCoords)) {\n        return;\n    }\n    if (isAdjacent(col, row, length, isRotated, playerShipCoords)) {\n        return;\n    }\n    \n    board1.appendChild(draggableElement);\n    draggableElement.style.position = 'absolute';\n    draggableElement.style.left = `${snapLeft}px`;\n    draggableElement.style.top = `${snapTop}px`;\n\n    // add placed class\n    draggableElement.classList.add('placed');\n    // store coordinates\n    setShip(snapLeft/40, snapTop/40, draggableElement);\n}\n\nboard1.addEventListener('click', handleShipRotate);\nfunction handleShipRotate(e) {\n    if (e.target.classList.contains('placed')) {\n        const shipEle = e.target;\n        shipEle.classList.toggle('rotated');\n        setShip(parseInt(shipEle.style.left.slice(0, -2), 10)/40, \n            parseInt(shipEle.style.top.slice(0, -2), 10)/40, shipEle);\n    }\n}\n\ndocument.getElementById('reset').addEventListener('click', resetBoard);\n\nfunction resetBoard() {\n    location.reload();\n}\n\nconst shipCoords1 = new Map();\nconst shipCoords2 = new Map();\nconst computerShipCoords = new Set();\nconst playerShipCoords = new Set();\nconst computerGuesses = new Set();\n\nconst randomizeButton = document.getElementById('randomize');\nrandomizeButton.addEventListener('click', randomizePlayer);\n\nfunction randomizePlayer() {\n    shipCoords1.clear();\n    playerShipCoords.clear();\n\n    const shipIds = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j'];\n    for (const s of shipIds) {\n        const shipId = `s${s}`;\n        const shipElement = document.getElementById(shipId);\n        \n        shipElement.classList.remove('placed', 'rotated');\n        shipElement.style.position = '';\n        shipElement.style.left = '';\n        shipElement.style.top = '';\n        \n        shipDock.appendChild(shipElement);\n    }\n    \n    for (const s of shipIds) {\n        const shipId = `s${s}`;\n        const length = getShipLength(shipId);\n        const shipElement = document.getElementById(shipId);\n        \n        let placed = false;\n        while (!placed) {\n            let isRotated = Math.random() > 0.5;\n            let row = Math.floor(Math.random() * 10);\n            let col = Math.floor(Math.random() * 10);\n            \n            const overflow = isOverflowing(col, row, length, isRotated);\n            const overlap = isOverlapping(col, row, length, isRotated, playerShipCoords);\n            const adjacent = isAdjacent(col, row, length, isRotated, playerShipCoords);\n            \n            if (!overflow && !overlap && !adjacent) {\n                if (isRotated) {\n                    shipElement.classList.add('rotated');\n                } else {\n                    shipElement.classList.remove('rotated');\n                }\n                \n                shipElement.style.position = 'absolute';\n                shipElement.style.left = `${col * 40}px`;\n                shipElement.style.top = `${row * 40}px`;\n                shipElement.classList.add('placed');\n                \n                board1.appendChild(shipElement);\n\n                setShip(col, row, shipElement); \n                \n                placed = true;\n            }\n        }\n    }\n    playBtn.disabled = false;\n}\n\nfunction isOverflowing(col, row, length, isRotated) {\n    if (isRotated) {\n        return row + length > 10;\n    }\n    else {\n        return col + length > 10;\n    }\n}\n\nfunction isOverlapping(col, row, length, isRotated, coordsSet) {\n    for (let i=0; i<length; i++) {\n        let coord;\n        if (isRotated) {\n            coord = `${row+i},${col}`;\n        }\n        else {\n            coord = `${row},${col+i}`;\n        }\n        if (coordsSet.has(coord)) {\n            return true;\n        }\n    }\n    return false;\n}\n\nfunction isAdjacent(col, row, length, isRotated, coordsSet) {\n    const proposedCoords = new Set();\n    for (let i = 0; i < length; i++) {\n        if (isRotated) {\n            proposedCoords.add(`${row + i},${col}`);\n        } else {\n            proposedCoords.add(`${row},${col + i}`);\n        }\n    }\n    \n    // check all neighbors of each proposed cell\n    // (r,c):(r-1,c-1),(r-1,c),(r-1,c+1),(r,c-1),(r,c+1),\n    // (r+1,c-1),(r+1,c),(r+1,c+1).\n    for (const coordStr of proposedCoords) {\n        const [r, c] = coordStr.split(',').map(Number); \n        for (let dr = -1; dr <= 1; dr++) {\n            for (let dc = -1; dc <= 1; dc++) {\n                if (dr === 0 && dc === 0) continue; \n                const neighborCoord = `${r + dr},${c + dc}`;\n                if (coordsSet.has(neighborCoord) && !proposedCoords.has(neighborCoord)) {\n                    return true;\n                }\n            }\n        }\n    }\n    return false;\n}\n\nfunction setShip(left, top, ele) {\n    const id = ele.id;\n    const isRotated = ele.classList.contains('rotated');\n    let length = getShipLength(id);\n    if (shipCoords1.has(id)) {\n        const oldCoords = shipCoords1.get(id);\n        for (const c of oldCoords) {\n            playerShipCoords.delete(`${c[0]},${c[1]}`);\n        }\n    }\n\n    shipCoords1.set(id, []);\n    \n    for (let i=0; i<length; i++) {\n        if (isRotated) {\n            shipCoords1.get(id).push([top+i, left]);\n            playerShipCoords.add(`${top+i},${left}`);\n        }\n        else {\n            shipCoords1.get(id).push([top, left+i]);\n            playerShipCoords.add(`${top},${left+i}`);\n        }\n    }\n    if (shipCoords1.size === 10) {\n        playBtn.disabled = false;\n    }\n}\n\nfunction getShipLength(id) {\n    if (id === \"sa\") {return 4;}\n    else if (id === \"sb\" || id === \"sc\") {return 3;}\n    else if (id === \"sd\" || id === \"se\" || id === \"sf\") {return 2;}\n    else {return 1;}\n}\n\nfunction updateStatus(message) {\n    document.querySelector('.info').textContent = message;\n}\nconst playBtn = document.getElementById('play');\n\nplayBtn.addEventListener('click', () => {\n    randomizeComputer();\n    startGame();\n})\n\nconst playerShips = new Set();\nfunction startGame() {\n    playBtn.disabled = true;\n    randomizeButton.disabled = true;\n\n    updateStatus('Your turn! Attack the enemy.');\n    frame2.classList.toggle('hidden');\n    shipDock.classList.toggle('hidden');\n\n    board1.removeEventListener('dragover', handleDragOver);\n    board1.removeEventListener('drop', handleDrop);\n    board1.removeEventListener('click', handleShipRotate);\n\n    board2.addEventListener('click', handlePlayerAttack);\n}\n\nfunction handlePlayerAttack(e) {\n    const cell = e.target;\n    const row = cell.dataset.row;\n    const col = cell.dataset.col;\n    const coord = `${row},${col}`;\n\n    if (cell.classList.contains('hit') || cell.classList.contains('miss')) {\n        return;\n    }\n\n    if (computerShipCoords.has(coord)) {\n        cell.classList.add('hit');\n        computerShipCoords.delete(coord);\n        updateStatus('Hit!');\n\n        if (computerShipCoords.size === 0) {\n            endGame(true);\n            return;\n        } else {\n            board2.removeEventListener('click', handlePlayerAttack);\n            setTimeout(computerTurn, 500);\n        }\n    }\n    else {\n        cell.classList.add('miss');\n        updateStatus('Miss!');\n        board2.removeEventListener('click', handlePlayerAttack);\n        setTimeout(computerTurn, 500);\n    }\n}\n\nfunction randomizeComputer() {\n    const computerShips = [4,3,3,2,2,2,1,1,1,1];\n    for (const length of computerShips) {\n        let placed = false;\n        while (!placed) {\n            let col = Math.floor(Math.random() * 10);\n            let row = Math.floor(Math.random() * 10);\n            let isRotated = Math.random() > 0.5;\n\n            const overflow = isOverflowing(col, row, length, isRotated);\n            const overlap = isOverlapping(col, row, length, isRotated, computerShipCoords);\n            const adjacent = isAdjacent(col, row, length, isRotated, computerShipCoords);\n            \n            if (!overflow && !overlap && !adjacent) {\n                const shipId = `c-ship-${length}-${col},${row}`;\n                shipCoords2.set(shipId, []);\n\n                for (let i=0; i<length; i++) {\n                    if (isRotated) {\n                        shipCoords2.get(shipId).push([row+i, col]);\n                        computerShipCoords.add(`${row+i},${col}`);\n                    }\n                    else {\n                        shipCoords2.get(shipId).push([row, col+i]);\n                        computerShipCoords.add(`${row},${col+i}`);\n                    }\n                }\n                placed = true;\n            }\n        }\n    }\n}\n\nfunction computerTurn() {\n    let guessCoord;\n    let validGuess = false;\n\n    let row, col;\n\n    while (!validGuess) {\n        row = Math.floor(Math.random() * 10);\n        col = Math.floor(Math.random() * 10);\n        guessCoord = `${row},${col}`;\n\n        if (!computerGuesses.has(guessCoord)) {\n            validGuess = true;\n            computerGuesses.add(guessCoord);\n        }\n    }\n\n    if (playerShipCoords.has(guessCoord)) {\n        board1.querySelector(`[data-row='${row}'][data-col='${col}']`).classList.add('hit');\n        playerShipCoords.delete(guessCoord);\n        if (playerShipCoords.size === 0) {\n            endGame(false);\n            return;\n        }\n    }\n    else {\n        board1.querySelector(`[data-row='${row}'][data-col='${col}']`).classList.add('miss');\n    }\n    updateStatus('Your turn!');\n    board2.addEventListener('click', handlePlayerAttack);\n}\n\nfunction endGame(playerWon) {\n    board2.removeEventListener('click', handlePlayerAttack);\n\n    if (playerWon) {\n        updateStatus('YOU WIN!');\n    }\n    else {\n        updateStatus('The computer wins.');\n    }\n}\n\n//# sourceURL=webpack:///./src/index.js?\n}");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/index.js"]();
/******/ 	
/******/ })()
;